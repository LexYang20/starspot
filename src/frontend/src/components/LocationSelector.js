import React, { useState } from "react";
import "./LocationSelector.css";
import { collection, getDocs, query, where } from "firebase/firestore";
import { db } from "../firebaseConfig";

const LocationSelector = ({ onCitySelect }) => {
    const [selectedProvince, setSelectedProvince] = useState(""); // Selected province
    const [selectedCity, setSelectedCity] = useState(""); // Selected city
    const [cities, setCities] = useState([]); // List of cities for selected province

    // Province and city data
    const provinceCityMap = {"Alberta": ["Airdrie", "Brock", "Beaumont", "Brooks", "Banff", "Blackfalds", "Bonnyville", "Calgary", "Cochrane", "Chestermere", "Crowsnest Pass", "Camrose", "Canmore", "Cold Lake", "Coaldale", "Drayton Valley", "Devon", "Didsbury", "Drumheller", "Edmonton", "Edson", "Fort Saskatchewan", "Grande Prairie", "Hinton", "High River", "Innisfail", "Lethbridge", "Lloydminster", "Lake Louise", "Leduc", "Lacombe", "Medicine Hat", "Morinville", "Okotoks", "Olds", "Peace River", "Ponoka", "Redcliff", "Rocky Mountain House", "Red Deer", "Sylvan Lake", "St. Paul", "Stony Plain", "Saint-Paul", "Stettler", "St. Albert", "Strathmore", "Spruce Grove", "Taber", "Three Hills", "Vegreville", "Wainwright", "Westlock", "Wood Buffalo", "Wetaskiwin"], "British Columbia": ["Abbotsford", "Burnaby", "Cranbrook", "Campbell River", "Courtenay", "Coldstream", "Colwood", "Castlegar", "Chilliwack", "Central Saanich", "Creston", "Coquitlam", "Comox", "Duncan", "Delta", "Douglas", "Dawson Creek", "East Kelowna", "Esquimalt", "Fort St. John", "Fernie", "Golden", "Hope", "Kent", "Kimberley", "Kamloops", "Kelowna", "Kitimat", "Langford Station", "Langley", "Ladysmith", "Lake Country", "Merritt", "Maple Ridge", "Mission", "North Vancouver", "North Saanich", "New Westminster", "North Cowichan", "Nelson", "Nanaimo", "Northern Rockies", "Osoyoos", "Oak Bay", "Port Alberni", "Prince Rupert", "Penticton", "Pitt Meadows", "Prince George", "Port Coquitlam", "Parksville", "Peachland", "Port Moody", "Powell River", "Quesnel", "Qualicum Beach", "Richmond", "Salmon Arm", "Surrey", "Saanich", "Sidney", "Smithers", "Squamish", "Sechelt", "Spallumcheen", "Sooke", "Summerland", "Terrace", "Taché", "Trail", "Vancouver", "View Royal", "Victoria", "Vernon", "Williams Lake", "Whistler", "West Vancouver", "White Rock"], "Manitoba": ["Argyle", "Brandon", "Brokenhead", "Churchill", "Dauphin", "East St. Paul", "Flin Flon", "Gimli", "La Broquerie", "Macdonald", "Morden", "Portage La Prairie", "Ritchot", "Selkirk", "Steinbach", "Ste. Anne", "The Pas", "Thompson", "West St. Paul", "Winkler", "Winnipeg"], "New Brunswick": ["Beresford", "Beaubassin East / Beaubassin-est", "Bathurst", "Campbellton", "Dieppe", "Edmundston", "Fredericton", "Grand Falls", "Moncton", "Mapleton", "Miramichi", "Oromocto", "Quispamsis", "Riverview", "Rothesay", "Saint John", "Shediac", "Sackville", "St. Andrews", "Tracadie"], "Newfoundland and Labrador": ["Bay Roberts", "Conception Bay South", "Clarenville", "Corner Brook", "Deer Lake", "Gander", "Happy Valley", "Labrador City", "Marystown", "Mount Pearl Park", "Portugal Cove-St. Philip's", "Paradise", "St. John's", "Stephenville", "Saint Anthony", "Torbay"], "Nova Scotia": ["Antigonish", "Amherst", "Bridgewater", "Burton", "Barrington", "Cape Breton", "Church Point", "Chester", "Halifax", "Inverness", "Kentville", "New Glasgow", "Stanley", "Springfield", "Truro", "Wilmot", "Yarmouth"], "Ontario": ["Amherstburg", "Ajax", "Aurora", "Alfred and Plantagenet", "Adjala-Tosorontio", "Ashfield-Colborne-Wawanosh", "Arran-Elderslie", "Augusta", "Arnprior", "Aylmer", "Alnwick/Haldimand", "Beckwith", "Brampton", "Burlington", "Brockville", "Bayham", "Bluewater", "Bracebridge", "Brockton", "Brantford", "Brighton", "Belleville", "Brant", "Barrie", "Bradford West Gwillimbury", "Blandford-Blenheim", "Chatsworth", "Carleton Place", "Chatham", "Collingwood", "Clarence-Rockland", "Cornwall", "Cambridge", "Central Elgin", "Cavan Monaghan", "Clarington", "Cramahe", "Central Huron", "Clearview", "Centre Wellington", "Caledon", "Cobourg", "Dysart et al", "Drummond/North Elmsley", "Douro-Dummer", "Dryden", "Essa", "Elliot Lake", "East Gwillimbury", "Edwardsburgh/Cardinal", "East Zorra-Tavistock", "Essex", "Erin", "Elizabethtown-Kitley", "Fort Frances", "Fort Erie", "Front of Yonge", "Georgina", "Greater Napanee", "Grimsby", "Gravenhurst", "Georgian Bluffs", "Grey Highlands", "Guelph", "Gananoque", "Guelph/Eramosa", "Goderich", "Hanover", "Huron East", "Hawkesbury", "Hamilton Township", "Hamilton", "Hindon Hill", "Hearst", "Huntsville", "Halton Hills", "Huron-Kinloss", "Innisfil", "Ingersoll", "Kenora", "Kawartha Lakes", "Kirkland Lake", "Kapuskasing", "Kincardine", "Kingsville", "Kitchener", "Lambton Shores", "Loyalist", "London", "Lincoln", "Lanark Highlands", "Laurentian Valley", "LaSalle", "Leamington", "Leeds and the Thousand Islands", "Lakeshore", "Mississauga", "Markham", "Minto", "Mississippi Mills", "Milton", "Middlesex Centre", "Malahide", "McNab/Braeside", "Muskoka Falls", "Mono", "Meaford", "Midland", "North Dundas", "Norwich", "Niagara-on-the-Lake", "North Dumfries", "Newmarket", "North Grenville", "North Perth", "North Glengarry", "North Middlesex", "North Stormont", "Niagara Falls", "New Tecumseth", "North Bay", "Oliver Paipoonge", "Ottawa", "Oshawa", "Orangeville", "Oakville", "Oro-Medonte", "Owen Sound", "Orillia", "Otonabee-South Monaghan", "Peterborough", "Plympton-Wyoming", "Port Colborne", "Perth", "Parry Sound", "Pembroke", "Petawawa", "Perth East", "Penetanguishene", "Petrolia", "Port Hope", "Pickering", "Puslinch", "Pelham", "Quinte West", "Queens", "Richmond Hill", "Rockwood", "Russell", "Renfrew", "Rideau Lakes", "Ramara", "Springwater", "South-West Oxford", "South Huron", "Saugeen Shores", "Sault Ste. Marie", "South Bruce", "South Frontenac", "South Glengarry", "St. Clements", "Sarnia", "Stouffville", "Shelburne", "Scugog", "Southgate", "South Bruce Peninsula", "Sioux Lookout", "Severn", "St. Catharines", "Sudbury", "South Stormont", "Southwest Middlesex", "Strathroy-Caradoc", "St. Thomas", "South Dundas", "Selwyn", "Smiths Falls", "St. Marys", "Stratford", "Stone Mills", "St. Clair", "The Nation / La Nation", "Trent Hills", "Thorold", "Tillsonburg", "Trent Lakes", "Thunder Bay", "Tay Valley", "Thames Centre", "Toronto", "Timmins", "Tiny", "Tecumseh", "The Blue Mountains", "Tweed", "Tay", "Temiskaming Shores", "Uxbridge", "Vaughan", "Wellington North", "Windsor", "West Grey", "Waterloo", "Wasaga Beach", "Whitby", "Wellesley", "West Perth", "Wainfleet", "West Nipissing / Nipissing Ouest", "Woodstock", "Whitewater Region", "Woolwich", "West Lincoln", "Welland", "Zorra"], "Prince Edward Island": ["Charlottetown", "Summerside"], "Quebec": ["Alma", "Acton Vale", "Amqui", "Amos", "Asbestos", "Bois-des-Filion", "Brossard", "Bromont", "Beauceville", "Blainville", "Boucherville", "Baie-Saint-Paul", "Beauharnois", "Beaconsfield", "Bécancour", "Beauport", "Blanc-Sablon", "Brownsburg", "Beloeil", "Baie-Comeau", "Boisbriand", "Boischatel", "Cowansville", "Carignan", "Champlain", "Coteau-du-Lac", "Chandler", "Châteauguay", "Cookshire", "Cantley", "Chibougamau", "Contrecoeur", "Coaticook", "Côte-Saint-Luc", "Charlemagne", "Candiac", "Chambly", "Dollard-des-Ormeaux", "Dorval", "Delson", "Drummondville", "Donnacona", "Deux-Montagnes", "Farnham", "Gaspé", "Granby", "Gatineau", "Hampstead", "Hudson", "Joliette", "Kirkland", "Kuujjuaq", "Lac-Brome", "Lac-Mégantic", "L'Assomption", "L'Île-Perrot", "Louiseville", "Laval", "Lévis", "Lorraine", "Les Îles-de-la-Madeleine", "La Tuque", "L'Ange-Gardien", "La Pêche", "La Prairie", "L'Epiphanie", "Lachute", "L'Ancienne-Lorette", "La Malbaie", "Lavaltrie", "La Sarre", "Longueuil", "Les Cèdres", "Matane", "Mercier", "McMasterville", "Mont-Royal", "Magog", "Mont-Joli", "Mascouche", "Montréal", "Montréal-Ouest", "Marieville", "Mirabel", "Montmagny", "Mont-Saint-Hilaire", "Mont-Tremblant", "Mont-Laurier", "Mistassini", "Notre-Dame-du-Mont-Carmel", "Notre-Dame-de-l'Île-Perrot", "Nicolet", "Notre-Dame-des-Prairies", "Otterburn Park", "Old Chelsea", "Port-Cartier", "Pontiac", "Pointe-Claire", "Prévost", "Pont-Rouge", "Plessisville", "Pointe-Calumet", "Pincourt", "Princeville", "Quebec City", "Roberval", "Rimouski", "Rivière-du-Loup", "Repentigny", "Rawdon", "Richelieu", "Rouyn-Noranda", "Rosemère", "Rigaud", "Shannon", "Saint-Lambert-de-Lauzon", "Sainte-Brigitte-de-Laval", "Sherbrooke", "Sainte-Agathe-des-Monts", "Saint-Augustin-de-Desmaures", "Saint-Amable", "Sorel-Tracy", "Salaberry-de-Valleyfield", "Saint-Lazare", "Saint-Jérôme", "Saint-Bruno-de-Montarville", "Sainte-Adèle", "Sainte-Julienne", "Saint-Sauveur", "Saint-Pie", "Saint-Hippolyte", "Saint-Henri", "Sainte-Julie", "Saint-Rémi", "Saint-Hyacinthe", "Saint-Eustache", "Saint-Honoré", "Saint-Raymond", "Saint-Calixte", "Sainte-Thérèse", "Saint-Constant", "Saint-Césaire", "Sainte-Catherine", "Saint-Apollinaire", "Saint-Basile-le-Grand", "Sainte-Marthe-sur-le-Lac", "Saint-Lin--Laurentides", "Saguenay", "Sainte-Martine", "Saint-Charles-Borromée", "Saint-Lambert", "Sainte-Sophie", "Saint-Félicien", "Saint-Jean-sur-Richelieu", "Sainte-Anne-des-Monts", "Sainte-Marie", "Sainte-Catherine-de-la-Jacques-Cartier", "Saint-Philippe", "Sept-Îles", "Saint-Zotique", "Shawinigan", "Sainte-Anne-des-Plaines", "Saint-Colomban", "Stoneham-et-Tewkesbury", "Saint-Joseph-du-Lac", "Saint-Félix-de-Valois", "Trois-Rivières", "Thetford Mines", "Terrebonne", "Témiscouata-sur-le-Lac", "Verchères", "Varennes", "Val-David", "Victoriaville", "Val-d'Or", "Vaudreuil-Dorion", "Val-des-Monts", "Val-Shefford", "Westmount"], "Saskatchewan": ["Corman Park No. 344", "Estevan", "Humboldt", "La Ronge", "Melfort", "Moose Jaw", "Meadow Lake", "Martensville", "North Battleford", "Prince Albert", "Regina", "Saskatoon", "Swift Current", "Weyburn", "Warman", "Yorkton"], "Northwest Territories": ["Fort Simpson", "Hay River", "Inuvik", "Norman Wells", "Yellowknife"], "Nunavut": ["Arctic Bay", "Clyde River", "Grise Fiord", "Gjoa Haven", "Iqaluit", "Igloolik", "Kinngait", "Pangnirtung", "Pond Inlet", "Qikiqtarjuaq", "Resolute", "Rankin Inlet"], "Yukon": ["Whitehorse"]}

    const fetchData = async (cityName) => {
        try {
            const q = query(collection(db, "aurora_forecasts"), where("city", "==", `${cityName}, Canada`));
            const querySnapshot = await getDocs(q);

            if (!querySnapshot.empty) {
                const docData = querySnapshot.docs[0].data();
                onCitySelect(cityName, docData.KP_index, docData.forecast);
            } else {
                onCitySelect(cityName, "No data", []);
            }
        } catch (error) {
            console.error("Error fetching data:", error);
            onCitySelect(cityName, "Error", []);
        }
    };

    return (
        <div className="selector-container">
            <select onChange={(e) => {
                setSelectedProvince(e.target.value);
                setCities(provinceCityMap[e.target.value] || []);
                setSelectedCity(""); // Reset city selection
            }}>
                <option value="">Select Province</option>
                {Object.keys(provinceCityMap).map((province) => (
                    <option key={province} value={province}>{province}</option>
                ))}
            </select>

            <select onChange={(e) => setSelectedCity(e.target.value)} disabled={!selectedProvince}>
                <option value="">Select City</option>
                {cities.map((city) => (
                    <option key={city} value={city}>{city}</option>
                ))}
            </select>

            <button onClick={() => fetchData(selectedCity)} disabled={!selectedCity}>
                Get Forecast Data
            </button>
        </div>
    );
};

export default LocationSelector;